#!/usr/bin/env bash
#/ Usage: update-global-packages
#/
#/ Update All The Things:
#/   - MacOS
#/   - App Store installed apps
#/   - Homebrew packages (formulas and casks)
#/   - global Python packages
#/

set -e

# if help requested, print the comments at the top of the file
[[ "$1" =~ -h|(--)?help ]] && {
  grep "^#/" < "$0" | cut -c4-
  exit 0
}


echo "==> Updating MacOS and App Store-installed apps as needed..."
softwareupdate --install --all --force --agree-to-license


echo "==> Updating Homebrew, and upgrading formulas and casks as needed..."
brew update
brew upgrade --display-times --require-sha


python_packages="${GLOBAL_CONFIGS_DIR}/requirements.txt"
if [[ -r "${python_packages}" ]]; then
  echo "==> Updating global Python packages (if needed)..."
  pip install --upgrade --progress-bar ascii --requirement "${python_packages}"
else
  echo "Cannot find global Python requirements file!" >&2
  exit 1 
fi
